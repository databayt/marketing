// prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  ADMIN
  USER
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String?   @unique
  emailVerified      DateTime?
  image              String?
  password           String?
  role               UserRole  @default(USER)
  accounts           Account[]
  isTwoFactorEnabled Boolean   @default(false)
  twoFactorConfirmation TwoFactorConfirmation?
  
  // Web design business relationships
  projects           Project[]
  inquiries          Inquiry[]
  testimonials       Testimonial[]
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model Account {
  id                 String   @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorConfirmation {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Web Design Service Models

model ServicePackage {
  id                String   @id @default(cuid())
  name              String   // basic, premium, enterprise
  description       String
  price             Int      // Price in cents
  features          String[] // Array of feature descriptions
  deliveryTime      String   // e.g., "2-3 weeks", "1 month"
  revisions         Int      // Number of revisions included
  isActive          Boolean  @default(true)
  
  // Stripe integration
  stripePriceId     String?  @unique
  
  // Relationships
  projects          Project[]
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("service_packages")
}

model Project {
  id                String   @id @default(cuid())
  userId            String
  servicePackageId  String
  title             String
  description       String
  status            ProjectStatus @default(PENDING)
  budget            Int      // Budget in cents
  startDate         DateTime?
  completionDate    DateTime?
  requirements      String?  // Additional requirements
  
  // Relationships
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  servicePackage    ServicePackage   @relation(fields: [servicePackageId], references: [id])
  milestones        Milestone[]
  payments          Payment[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("projects")
}

model Milestone {
  id          String        @id @default(cuid())
  projectId   String
  title       String
  description String
  status      MilestoneStatus @default(PENDING)
  dueDate     DateTime
  completedAt DateTime?
  
  // Relationships
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("milestones")
}

model Payment {
  id          String        @id @default(cuid())
  projectId   String
  amount      Int           // Amount in cents
  status      PaymentStatus @default(PENDING)
  stripePaymentId String?   @unique
  paidAt      DateTime?
  
  // Relationships
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("payments")
}

model Inquiry {
  id          String   @id @default(cuid())
  userId      String?
  name        String
  email       String
  phone       String?
  company     String?
  projectType String   // "website", "app", "branding", etc.
  description String
  budget      String?  // "Under $1000", "$1000-$5000", etc.
  timeline    String?  // "ASAP", "1-2 months", etc.
  status      InquiryStatus @default(NEW)
  
  // Relationships
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("inquiries")
}

model Testimonial {
  id          String   @id @default(cuid())
  userId      String?
  clientName  String
  company     String?
  projectType String
  rating      Int      // 1-5 stars
  content     String
  isApproved  Boolean  @default(false)
  isFeatured  Boolean  @default(false)
  
  // Relationships
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("testimonials")
}

// Enums
enum ProjectStatus {
  PENDING
  IN_PROGRESS
  REVIEW
  COMPLETED
  CANCELLED
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DELAYED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum InquiryStatus {
  NEW
  CONTACTED
  PROPOSAL_SENT
  NEGOTIATING
  CONVERTED
  LOST
}
